IF OBJECT_ID('tempdb.dbo.#TEMP_BASE') is not null DROP TABLE #TEMP_BASE
Go

SELECT '1' AS TIPO,
	SUM(FATOFINANCEIRO_R.VALOR*FATOFINANCEIRO_R.SINAL) AS VALOR, 
	FATOFINANCEIRO_R.RTPO, 
	T.NOME
	INTO #TEMP_BASE
FROM 
	FATOFINANCEIRO_R, 
	CAIXABANCARIA,
	TPO_R T
	
WHERE FATOFINANCEIRO_R.RFONTEPAGADORA = CAIXABANCARIA.OID
	AND T.OID =  FATOFINANCEIRO_R.RTPO
	AND FATOFINANCEIRO_R.SITUACAO = 1
	AND FATOFINANCEIRO_R.RATOFINANCEIRO <= 7
	AND FATOFINANCEIRO_R.RTPO > 7   
	AND FATOFINANCEIRO_R.DATA >= '20100101'
	AND FATOFINANCEIRO_R.DATA <= '20500228 23:59:59'
	AND FATOFINANCEIRO_R.RMOEDA = 113702 
	AND NOT EXISTS ( SELECT 1 FROM UTILIZACAO U WHERE U.RITEM = FATOFINANCEIRO_R.OID )  
	AND CAIXABANCARIA.RITEM IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
GROUP BY FATOFINANCEIRO_R.RTPO,T.NOME

UNION

SELECT 
	'2',
	SUM(PG.VALOR),
	CONTA.RTPO, --AT.RTIPO, CAT.RSUPER
	T.NOME
FROM  
	PAGAMENTO PG, 
	CONTAAPAGAR_R CONTA, 
	ACAOFINANCEIRA AF,
	ATOFINANCEIRO AT, 
	CATEGORIA CAT,
	TPO_R T
WHERE 
	CONTA.RSITUACAO IN ( 2346, 2347 )
	AND CONTA.RTPO = T.OID
	AND CONTA.OID = AF.RCONTA 
	AND AF.OID = PG.RACAOFINANCEIRA
	AND AF.RATOFINANCEIRO = AT.OID 
	AND AT.RTIPO IN  ( 2372, 23709, 23724 ) 
	AND NOT ( AT.RTIPO = 23724 
	AND CONTA.RTIPO = 23669 )
	AND AT.RESTORNO = 7 
	AND PG.RTIPO = CAT.OID  
	AND AT.DATA >= '20100101'
	AND AT.DATA <= '20500228 23:59:59'
	 AND CONTA.RMOEDA1 = 113702 
	 AND CONTA.RDESTINATARIO IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
 GROUP BY CONTA.RTPO, AT.RTIPO, CAT.RSUPER,T.NOME

 UNION SELECT 
	'3',
	SUM(PG.VALOR),
	CONTA.RTPO, --AT.RTIPO, CAT.RSUPER
	T.NOME
FROM  
	PAGAMENTO PG, 
	CONTAARECEBER_R CONTA, 
	ACAOFINANCEIRA AF,
	ATOFINANCEIRO AT, 
	CATEGORIA CAT,
	TPO_R T
WHERE CONTA.RSITUACAO IN ( 2346, 2347 )
	AND CONTA.RTPO = T.OID
	AND CONTA.OID = AF.RCONTA 
	AND AF.OID = PG.RACAOFINANCEIRA
	AND AF.RATOFINANCEIRO = AT.OID 
	AND AT.RTIPO IN ( 2718, 23739, 23744 )  
	AND NOT ( AT.RTIPO = 23744 AND CONTA.RTIPO = 23669 )
	AND AT.RESTORNO = 7 
	AND PG.RTIPO = CAT.OID   
	AND AT.DATA >= '20100101'
	AND AT.DATA <= '20500228 23:59:59'
	AND CONTA.RMOEDA1 = 113702 
	AND CONTA.REMITENTE IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	GROUP BY CONTA.RTPO, AT.RTIPO, CAT.RSUPER,T.NOME

UNION
SELECT '4', SUM(FATOFINANCEIRO_R.VALOR*FATOFINANCEIRO_R.SINAL), FATOFINANCEIRO_R.RTPO, T.NOME
FROM 
	FATOFINANCEIRO_R, UTILIZACAO U, TPO_R T
WHERE FATOFINANCEIRO_R.OID = U.RITEM
	AND FATOFINANCEIRO_R.RTPO = T.OID
	AND FATOFINANCEIRO_R.SITUACAO = 1
	AND FATOFINANCEIRO_R.RATOFINANCEIRO <= 7
	AND FATOFINANCEIRO_R.RTPO > 7   
	AND FATOFINANCEIRO_R.DATA >= '20100101' 
	AND FATOFINANCEIRO_R.DATA <= '20500228 23:59:59'
	AND FATOFINANCEIRO_R.RMOEDA = 113702 
	AND U.RUTILIZADO IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	GROUP BY FATOFINANCEIRO_R.RTPO,T.NOME


UNION SELECT '5',
	SUM(FATOFINANCEIRO_R.VALOR*FATOFINANCEIRO_R.SINAL), 
	FATOFINANCEIRO_R.RTPO,
	T.NOME
FROM FATOFINANCEIRO_R, CAIXABANCARIA, ATOFINANCEIRO ATO,TPO_R T
WHERE FATOFINANCEIRO_R.RFONTEPAGADORA = CAIXABANCARIA.OID
	AND FATOFINANCEIRO_R.RTPO = T.OID
	AND FATOFINANCEIRO_R.SITUACAO = 1
	AND FATOFINANCEIRO_R.RATOFINANCEIRO > 7
	AND FATOFINANCEIRO_R.RATOFINANCEIRO = ATO.OID 
	AND ATO.RTIPO IN ( 29852, 23724, 23744, 38032 ) 
	AND FATOFINANCEIRO_R.RTPO > 7   
	AND FATOFINANCEIRO_R.DATA >= '20100101' 
	AND FATOFINANCEIRO_R.DATA <= '20500228 23:59:59'
	AND FATOFINANCEIRO_R.RMOEDA = 113702 
	AND CAIXABANCARIA.RITEM IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 )
 GROUP BY FATOFINANCEIRO_R.RTPO,T.NOME


UNION SELECT 
	'6',
	SUM(DO.VALORNAMOEDA1) AS Valor, 
	T.OID, 
	T.NOME 
FROM 
	DOCDEORIGEM_R DO, 
	NFSAIDACAD NFS, 
	NFENTRACAD NFE, 
	TPO_R T, 
	FILIALCAD F
WHERE 
	DO.OID = NFS.OIDDOCDEORIGEM 
	AND DO.OID = NFE.OIDDOCDEORIGEM 
	AND NFS.TPO = T.HIERARQUIANUMERO 
	AND NFS.FILIAL = F.FILIAL 
	AND T.HIERARQUIAMASCARA LIKE '9%'  
	AND DO.EMISSAO >= '20100101'  
	AND DO.EMISSAO <= '20500228 23:59:59'  
	AND DO.RMOEDA1 = 113702 
	AND F.OID IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 )
GROUP BY T.OID, T.NOME

UNION ALL

SELECT 	
	'7',
	SUM(DO.VALORNAMOEDA1) AS Valor, 
	T.OID, 
	T.NOME  
FROM DOCDEORIGEM_R DO, NFSAIDACAD NFS, NFENTRACAD NFE, TPO_R T, FILIALCAD F
WHERE DO.OID = NFS.OIDDOCDEORIGEM 
	AND DO.OID = NFE.OIDDOCDEORIGEM 
	AND NFE.TPO = T.HIERARQUIANUMERO 
	AND NFE.FILIAL = F.FILIAL 
	AND T.HIERARQUIAMASCARA LIKE '9%'  
	AND DO.EMISSAO >= '20100101'  
	AND DO.EMISSAO <= '20500228 23:59:59'   
	AND DO.RMOEDA1 = 113702 
	AND F.OID IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	AND NFE.TPO != NFS.TPO 

GROUP BY T.OID, T.NOME

ORDER BY T.NOME

SELECT* FROM #TEMP_BASE

--select * from tpo_r where oid in (2673408,2714246)
--update  tpo_r set nome = 'Despesas c/ Refeições' where oid in (2673408,2714246)