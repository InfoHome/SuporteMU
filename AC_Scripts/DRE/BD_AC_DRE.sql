DROP TABLE AC_DRE_DEMONSTRATIVO
DROP TABLE AC_DRE_GRUPO
DROP TABLE AC_DRE_ITENS
DROP TABLE AC_DRE_RESULT

DROP VIEW AC_DRE_CONSTRULAR_R
GO

USE BDENTER
GO
CREATE TABLE AC_DRE_DEMONSTRATIVO (
	ID INT NOT NULL IDENTITY,
	NOME VARCHAR(MAX) NOT NULL
)
INSERT INTO AC_DRE_DEMONSTRATIVO (NOME) VALUES 	('DRE A CONSTRULAR')

CREATE TABLE AC_DRE_GRUPO (
	ID INT NOT NULL IDENTITY,
	CODIGO CHAR(2) NOT NULL,
	NOME VARCHAR(MAX) NOT NULL,
	DEMONSTRATIVO INT NOT NULL
)
GO
INSERT INTO AC_DRE_GRUPO (CODIGO,NOME,DEMONSTRATIVO) VALUES 
	('01','(=) RECEITA OPERACIONAL BRUTA',1),
	('02','(=) DEDUÇÕES DA RECEITA BRUTA',1),
	('03','(=) RECEITA OPERACIONAL LÍQUIDA (1-2)',1),
	('04','(=) CUSTO DAS VENDAS',1),
	('05','(=) RESULTADO OPERACIONAL BRUTO ( LUCRO BRUTO (3-(4-5)))',1),
	('06','(=) DESPESAS OPERACIONAIS',1),
	('07','(=) RESULTADO OPERACIONAL (6-(7+8+9))',1),
	('08','(=) DESPESAS FINANCEIRAS LÍQUIDAS',1),
	('09','(=) OUTRAS RECEITAS E DESPESAS',1),
	('10','(=) RESULTADO ANTES DO IRPJ',1),
	('11','(=) RESULTADO LÍQUIDO',1),
	('12','(=) ATIVIDADES DE INVESTIMENTO',1),
	('13','(=) ATIVIDADES DE FINANCIAMENTO',1),
	('14','(=) MOVIMENTAÇÃO DOS SÓCIOS',1),
	('15','(=) RESULTADO FINAL',1)

GO
CREATE TABLE AC_DRE_ITENS (
	ID INT NOT NULL IDENTITY,
	SINAL INT NOT NULL,
	HIERARQUIA VARCHAR(MAX) NOT NULL,
	VARIACAO VARCHAR(MAX) NULL,
	DESCRICAO VARCHAR(MAX) NOT NULL,
	DEMONSTRATIVO INT NOT NULL
)
GO
INSERT INTO AC_DRE_ITENS (SINAL,HIERARQUIA,VARIACAO,DESCRICAO,DEMONSTRATIVO) VALUES
( 1,'01.001'	,'01.001'		,'VENDAS À VISTA',1),
( 1,'01.002'	,'01.002'		,'VENDAS À PRAZO',1),
( 1,'01.003'	,'01.003'		,'VENDAS C/ CARTÃO',1),
( 1,'01.004'	,'01.004'		,'PRESTAÇÃO DE SERVIÇOS',1),
(-1,'02.001'	,'02.001'		,'ABATIMENTOS/DESCONTOS CONCEDIDOS',1),
(-1,'02.002'	,'02.002'		,'DEVOLUÇÕES DE VENDAS',1),
( 1,'04.001'	,'04.001'		,'CUSTO DOS PRODUTOS VENDIDOS (CMV)',1),
( 1,'04.002'	,'04.002'		,'CUSTOS VARIÁVEIS',1),
( 0,'04.003'	,'04.003'		,'CUSTOS FIXOS',1),
( 1,'04.003.001','04.003.001'	,'MÃO DE OBRA PRÓPRIA',1),
( 1,'04.003.002','04.003.002'	,'PROVISÃO P/FÉRIAS E 13o. SALÁRIO',1),
( 1,'04.003.003','04.003.003'	,'FGTS E MULTA RESCISÓRIA',1),
( 1,'04.003.004','04.003.004'	,'OUTROS GASTOS DE PRODUÇÃO',1),
( 1,'04.004'	,'04.004'		,'ESTOQUE FINAL',1),
( 1,'04.005'	,'04.005'		,'CUSTO DAS DEVOLUÇÕES DE VENDAS (CMV)',1),
( 0,'04.006'	,'04.006'		,'IMPOSTOS E CONTRIBUIÇÕES INCIDENTES SOBRE VENDAS',1),
(-1,'04.006.001','04.006.001'	,'SIMPLES NACIONAL',1),
(-1,'04.006.002','04.006.002'	,'ICMS',1),
(-1,'04.006.003','04.006.003'	,'IRPJ',1),
(-1,'04.006.004','04.006.004'	,'CSLL',1),
(-1,'04.006.005','04.006.005'	,'PIS',1),
(-1,'04.006.006','04.006.006'	,'COFINS',1),
(-1,'04.006.007','04.006.007'	,'ISS',1),
( 0,'06.001'	,'06.001'		,'DESPESAS VARIÁVEIS C/ VENDAS',1),
(-1,'06.001.001','06.001.001'	,'COMISSÕES SOBRE VENDAS',1),
(-1,'06.001.002','06.001.002'	,'PROVISÃO P/FÉRIAS E 13o. SALÁRIO',1),
(-1,'06.001.003','06.001.003'	,'FGTS',1),
(-1,'06.001.004','06.001.004'	,'INSS',1),
(-1,'06.001.005','06.001.005'	,'MATERIAL DE EMBALAGEM',1),
(-1,'06.001.006','06.001.006'	,'DESPESAS COM ENTREGAS/VENDAS',1),
(-1,'06.001.007','06.001.007'	,'DESPESAS COM EVENTOS',1),
(-1,'06.001.008','06.001.008'	,'COMISSÃO DE INDICADORES/MESTAS',1),
(-1,'06.001.009','06.001.009'	,'DESPESA COM BRINDES',1),
(-1,'06.001.010','06.001.010'	,'SALÁRIOS DE VENDAS',1),
(-1,'06.001.011','06.001.011'	,'MULTAS RECISSÓRIAS',1),
(-1,'06.002.001','06.002.001'	,'SALÁRIOS DE VENDAS',1),
(-1,'06.002.002','06.002.002'	,'PROVISÃO P/FÉRIAS E 13o. SALÁRIO',1),
(-1,'06.002.003','06.002.003'	,'FGTS',1),
(-1,'06.002.004','06.002.004'	,'INSS',1),
(-1,'06.002.005','06.002.005'	,'VALE TRANSPORTE',1),
(-1,'06.002.006','06.002.006'	,'OUTROS GASTOS COM PESSOAL',1),
(-1,'06.002.007','06.002.007'	,'PROPAGANDA',1),
(-1,'06.002.008','06.002.008'	,'DESPESAS COM TREINAMENTOS',1),
(-1,'06.003.001','06.001.010'	,'SALÁRIOS',1),
(-1,'06.003.002','06.001.002'	,'PROVISÃO P/FÉRIAS E 13o. SALÁRIO',1),
(-1,'06.003.003','06.001.003'	,'FGTS',1),
(-1,'06.003.004','06.001.004'	,'INSS',1),
(-1,'06.003.005','06.003.005'	,'VALE TRANSPORTE',1),
(-1,'06.003.006','06.002.006'	,'OUTROS GASTOS COM PESSOAL',1),
(-1,'06.003.007','06.003.007'	,'LANCHES/REFEIÇÕES',1),
(-1,'06.003.008','06.003.008'	,'ALUGUEIS/IPTU/CONDOMÍNIOS/ALVARÁ/SUGURO PATRIMONIAL',1),
(-1,'06.003.009','06.003.009'	,'MATERIAL DE LIMPESA/COZINHA/HIGIENE',1),
(-1,'06.003.010','06.003.010'	,'CONSERVAÇÃO DE BENS INSTALAÇÕES',1),
(-1,'06.003.011','06.003.011'	,'AGUA/LUZ',1),
(-1,'06.003.012','06.003.012'	,'MATERIAL DE ESCRITORIO/INFORMATICA',1),
(-1,'06.003.013','06.003.013'	,'MANUTENÇÃO DE SISTEMAS',1),
(-1,'06.003.014','06.003.014'	,'TELEFONE/INTERNET',1),
(-1,'06.003.015','06.003.015'	,'RETIRADAS ALEX',1),
(-1,'06.003.016','06.003.016'	,'HONORÁRIOS CONTÁBEIS',1),
(-1,'06.003.017','06.003.017'	,'CONTRIBUIÇÃO ASSOCIAÇÃO CLASSE',1),
(-1,'06.003.018','06.003.018'	,'DESPESAS COM COBRANÇAS/BOLETO',1),
(-1,'06.003.019','06.003.019'	,'DESPESAS COM VEÍCULOS',1),
(-1,'06.003.020','06.003.020'	,'IMPOSTOS E TAXAS',1),
(-1,'06.003.021','06.003.021'	,'CARTORIO/CORREIOS',1),
(-1,'06.003.022','06.003.022'	,'DESPESAS COM SEGURANÇA',1),
(-1,'06.003.023','06.003.023'	,'DESPESAS COM VIAGENS/FEIRAS',1),
(-1,'06.003.024','06.003.024'	,'DESPESAS RATEADAS CONTORNO',1),
(-1,'06.003.025','06.003.025'	,'DESPESAS COM PERDAS DE PRODUTOS',1),
(-1,'06.003.026','06.003.026'	,'OUTRAS DESPESAS',1),
(-1,'06.003.027','06.003.027'	,'DEPRECIAÇÕES/AMORTIZAÇÕES',1),
(-1,'06.003.028','06.003.028'	,'DESPESAS COM MARKETING',1),
(-1,'06.003.029','06.003.029'	,'DESPESAS COM CONSULTORIAS',1),
(-1,'06.003.030','06.003.030'	,'DESPESAS COM PRESTAÇÃO DE SERVIÇOS',1),
(-1,'06.003.031','06.001.011'	,'MULTAS RECISSÓRIAS',1),
(-1,'06.003.032','06.003.032'	,'AQUISIÇÃO DE SERVIÇO ISSQN',1),
( 0,'08.001'    ,'08.001'		,'DESPESAS FINANCEIRAS',1),
(-1,'08.001.001','08.001.001'	,'TARIFAS/JUROS BANCÁRIAS/ALUGUEL MÁQUINAS DE CARTÃO',1),
(-1,'08.001.002','08.001.002'	,'DESPESAS DE FINANCIAMENTOS',1),
(-1,'08.001.003','08.001.003'	,'JUROS E DESCONTOS',1),
(-1,'08.001.004','08.001.004'	,'TAXA ADMINISTRATIVA/JUROS ANTECIPAÇÃO DE CARTÃO/CHEQUES ',1),
(-1,'08.001.005','08.001.005'	,'IOF',1),
( 0,'08.002'    ,'08.002'		,'RECEITAS FINANCEIRAS',1),
( 1,'08.002.001','08.002.001'	,'JUROS RECEBIDOS ',1),
( 1,'08.002.002','08.002.002'	,'DESCONTOS RECEBIDOS',1),
( 1,'09.001'	,'09.001'		,'OUTRAS RECEITAS NÃO OPERACIONAIS',1),
( 1,'09.002'	,'09.002'		,'ENCARGOS RECEBIMENTO',1),
(-1,'09.003'	,'09.003'		,'INDENIZAÇÕES JUDICIAIS',1),
(-1,'10.001'	,'10.001'		,'IMPOSTO DE RENDA',1),
(-1,'10.002'	,'10.002'		,'ADICIONAL IMPOSTO DE RENDA',1),
(-1,'10.003'	,'10.003'		,'CONTRIBUIÇÃO SOCIAL',1),
(-1,'11.999'	,'11.999'		,'RESULTADO LIQUIDO',1),
(-1,'12.001'	,'12.001'		,'OBRAS E REFORMAS',1),
(-1,'12.002'	,'12.002'		,'MÁQUINAS E EQUIPAMENTOS',1),
(-1,'12.003'	,'12.003'		,'VEÍCULOS',1),
(-1,'12.004'	,'12.004'		,'ARMAZEM CENTRO MANHUMIRIM',1),
(-1,'12.005'	,'12.005'		,'OUTROS',1),
( 1,'13.001'	,'13.001'		,'CAPTAÇÃO DE EMPRESTIMOS E FINANCIAMENTOS',1),
(-1,'13.002'	,'13.002'		,'AMORTIZAÇÃO DE EMPRESTIMOS E FINANCIAMENTOS',1),
(-1,'13.003'	,'13.003'		,'AMORTIZAÇÃO DE PASSIVOS DIVERSOS',1),
( 1,'14.001'	,'14.001'		,'APORTE DE CAPITAL',1),
(-1,'14.002'	,'14.002'		,'DISTRIBUIÇÃO DE LUCROS',1)

GO

CREATE TABLE AC_DRE_RESULT (
	ID INT NOT NULL IDENTITY,
	FILIAL VARCHAR(MAX) NULL,
	MES VARCHAR(MAX) NOT NULL,
	ANO VARCHAR(MAX) NOT NULL,
	SINAL INT NOT NULL,
	TIPO VARCHAR(MAX) NOT NULL,
	HIERARQUIA VARCHAR(MAX) NOT NULL,
	VALOR DECIMAL(15,2) NOT NULL
)
GO

CREATE VIEW AC_DRE_CONSTRULAR_R(
	DEMONSTRATIVO,
	CODIGO,
	GRUPO,
	SINAL,
	HIERARQUIA,
	VARIACAO,
	DESCRICAO)
AS select 
	DEMONSTRATIVO.NOME,
	GRUPO.CODIGO,
	GRUPO.NOME,
	ITENS.SINAL,
	ITENS.HIERARQUIA,
	ITENS.VARIACAO,
	ITENS.DESCRICAO 
from AC_DRE_DEMONSTRATIVO DEMONSTRATIVO 
	JOIN AC_DRE_GRUPO GRUPO ON DEMONSTRATIVO.ID = GRUPO.DEMONSTRATIVO
	join AC_DRE_ITENS ITENS ON GRUPO.CODIGO = LEFT(ITENS.HIERARQUIA,2)
		AND DEMONSTRATIVO.ID = ITENS.DEMONSTRATIVO
GO


--SELECT * FROM AC_DRE_DEMONSTRATIVO
--SELECT * FROM AC_DRE_GRUPO
--SELECT * FROM AC_DRE_ITENS
--SELECT * FROM AC_DRE_CONSTRULAR_R WHERE CODIGO = '06'


---- EXIBIÇÃO DO DRE CADASTRADOR
----------------------------------------------------------------
--SELECT 
--	--DRE.DEMONSTRATIVO, 
--	DRE.CODIGO + ' '+DRE.GRUPO AS GRUPO,
--	DRE.HIERARQUIA + ' - '+	DRE.DESCRICAO AS HIERARQUIA,
--	TPO.CODIGO +' - ' + TPO.NOME AS TPO
--FROM AC_DRE_CONSTRULAR_R DRE 
--	JOIN TPO_R TPO ON DRE.HIERARQUIA = TPO.OBSERVACAO
--ORDER BY GRUPO, HIERARQUIA



