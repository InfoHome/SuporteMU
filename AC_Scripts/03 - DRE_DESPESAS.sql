
-- 9 - Despesas Administrativas
--------------------------------------------------------------------------------
drop table #tmp_DRE_Contrular
SELECT 
	'1' AS ORIGEM,
	FATOFINANCEIRO_R.OID as [Codigo],
	FATOFINANCEIRO_R.DATA as [Data],
	'-' as [Sinal],
	'09 - Despesas Administrativas' as [Tipo], 
	'Despesas Administrativas' as [Operacao],
	CASE 
		WHEN FATOFINANCEIRO_R.RTPO = 4360902 THEN '09.03 - ' + T.NOME --9.14
		WHEN FATOFINANCEIRO_R.RTPO = 2683982 THEN '09.04 - ' + T.NOME --9.07
		WHEN FATOFINANCEIRO_R.RTPO = 9093199 THEN '12.04 - ' + T.NOME --12.4
		WHEN FATOFINANCEIRO_R.RTPO = 2300486 THEN '09.06 - ' + T.NOME --9.20
		WHEN FATOFINANCEIRO_R.RTPO = 2714271 THEN '09.06 - ' + T.NOME --9.20
		WHEN FATOFINANCEIRO_R.RTPO = 2300498 THEN '07.08 - ' + T.NOME --7.1
		WHEN FATOFINANCEIRO_R.RTPO = 2709379 THEN '07.08 - ' + T.NOME --7.1
		WHEN FATOFINANCEIRO_R.RTPO = 2714265 THEN '07.06 - ' + T.NOME --7.6

		----SEM CONTA ESPECÍFICA ------------------------------------
		WHEN FATOFINANCEIRO_R.RTPO = 2300507 THEN '99.02 - Conta indefinida! - ' + T.NOME --9.07
	ELSE 'Nivel 9 Indeterminado - ' + T.NOME
	end as [Hierarquia],
	FILIAL.CODIGO as [Filial],
	FATOFINANCEIRO_R.VALOR/**FATOFINANCEIRO_R.SINAL*/ AS VALOR
	into #tmp_DRE_Contrular
------------------------------------
FROM 
	FATOFINANCEIRO_R, 
	CAIXABANCARIA,
	TPO_R T,
	PESSOA_R FILIAL
	
WHERE FATOFINANCEIRO_R.RFONTEPAGADORA = CAIXABANCARIA.OID
	AND T.OID =  FATOFINANCEIRO_R.RTPO
	AND FILIAL.OID = CAIXABANCARIA.RITEM
	AND FATOFINANCEIRO_R.SITUACAO = 1
	AND FATOFINANCEIRO_R.RATOFINANCEIRO <= 7
	AND FATOFINANCEIRO_R.RTPO > 7   
	AND FATOFINANCEIRO_R.RMOEDA = 113702 
	AND NOT EXISTS ( SELECT 1 FROM UTILIZACAO U WHERE U.RITEM = FATOFINANCEIRO_R.OID )  
	AND CAIXABANCARIA.RITEM IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	AND FATOFINANCEIRO_R.RTPO in (
		4360902, -- 09.03 - Alex
		2683982, -- 09.04 - Aluguel Projetado
		9093199, -- 12.04 - Aplicações Financeiras
		2300486, 2714271, -- 09.06 - Cartório
		2300498, --	07.08 - Comissões
		2709379, --	07.08 - Comissões
		2714265, -- Comissões de Indicadores

		----SEM CONTA ESPECÍFICA ------------------------------------
		2300507 --Adiantamentos Colaboradores
	)

UNION ALL SELECT 
	'2' AS ORIGEM,
	PG.OID as [Codigo],
	AT.DATA as [Data],
	'-' as [Sinal],
	'09 - Despesas Administrativas' as [Tipo], 
	'Despesas Administrativas' as [Operacao],
	CASE 
		WHEN CONTA.RTPO = 2300474 THEN '09.01 - ' + T.NOME --9.10
		WHEN CONTA.RTPO = 2727274 THEN '09.02 - ' + T.NOME --9.07
		WHEN CONTA.RTPO = 4360902 THEN '09.03 - ' + T.NOME --9.14
		WHEN CONTA.RTPO = 2679697 THEN '12.03 - ' + T.NOME --12.3
		WHEN CONTA.RTPO = 6021891 THEN '02.03 - ' + T.NOME --2.3
		WHEN CONTA.RTPO = 25384195 THEN '02.03 - ' + T.NOME --2.3
		WHEN CONTA.RTPO = 4427400 THEN '16.01 - ' + T.NOME --16.1
		WHEN CONTA.RTPO = 2673414 THEN '09.05 - ' + T.NOME --9.16
		WHEN CONTA.RTPO = 2300498 THEN '07.08 - ' + T.NOME --7.1
		WHEN CONTA.RTPO = 2356541 THEN '05.02.02 - ' + T.NOME --5.2.2
		WHEN CONTA.RTPO = 5289599 THEN '09.07 - ' + T.NOME -- 9.18
		
		

		--SEM CONTA ESPECÍFICA ------------------------------------
		WHEN CONTA.RTPO = 73243334 THEN '99.01 - Conta indefinida! - ' + T.NOME --99.99
		WHEN CONTA.RTPO = 2300507  THEN '99.02 - Conta indefinida! - ' + T.NOME --99.99

	ELSE 'Nivel 9 Indeterminado - ' + T.NOME
	end as [Hierarquia],
	FILIAL.CODIGO as [Filial],
	CASE WHEN PG.VALOR < 0 THEN PG.VALOR *-1 ELSE PG.VALOR END as [Valor]
	

FROM  
	PAGAMENTO PG, 
	CONTAAPAGAR_R CONTA, 
	ACAOFINANCEIRA AF,
	ATOFINANCEIRO AT, 
	CATEGORIA CAT,
	TPO_R T,
	PESSOA_R FILIAL
WHERE 
	CONTA.RSITUACAO IN ( 2346, 2347 )
	AND CONTA.RTPO = T.OID
	AND FILIAL.OID = CONTA.RDESTINATARIO
	AND CONTA.OID = AF.RCONTA 
	AND AF.OID = PG.RACAOFINANCEIRA
	AND AF.RATOFINANCEIRO = AT.OID 
	AND AT.RTIPO IN  ( 2372, 23709, 23724 ) 
	AND NOT ( AT.RTIPO = 23724 
	AND CONTA.RTIPO = 23669 )
	AND AT.RESTORNO = 7 
	AND PG.RTIPO = CAT.OID  
	AND CONTA.RMOEDA1 = 113702 
	AND CONTA.RDESTINATARIO IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	AND CONTA.RTPO in (
		2300474, -- 09.01 - Água / Esgoto
		2727274, -- 09.02 - Aluguel
		4360902, -- 09.03 - Alex
		2679697, -- 12.03 - Aplicações
		6021891, -- 02.03 - Aquisição de Serviço Tributado ISSQN
		25384195, -- 02.03 - Aquisição de Serviço Tributado ISSQN (Aproveita Crédito Pis e Cofins)
		4427400, -- 16.01 - Armazém Centro Manhumirim
		2673414, -- 09.05 - Associacoes Diversas
		2300498, --	07.08 - Comissões
		2356541, -- 05.02.02 - Complemento de Nota Fiscal
		5289599, -- 09.07 - Compra de Combustiveís
	

		--SEM CONTA ESPECÍFICA ------------------------------------
		73243334, -- Adiantamentos a Forncedores
		2300507 -- Adiantamentos Colaboradores
		)
UNION SELECT 
	'3' AS ORIGEM,
	PG.OID as [Codigo],
	AT.DATA as [Data],
	'-' as [Sinal],
	'09 - Despesas Administrativas' as [Tipo], 
	'Despesas Administrativas' as [Operacao],
	CASE 
		WHEN CONTA.RTPO = 4945191 THEN '12.03 - ' + T.NOME --12.03
		WHEN CONTA.RTPO = 142402891 THEN '13.01 - ' + T.NOME --13.01
		WHEN CONTA.RTPO = 2356845 THEN '13.02 - ' + T.NOME --13.02
		WHEN CONTA.RTPO = 9397590 THEN '07.07 - ' + T.NOME --7.7
		--SEM CONTA ESPECÍFICA ------------------------------------
	


	ELSE 'Nivel 9 Indeterminado - ' + T.NOME
	end as [Hierarquia],
	FILIAL.CODIGO as [Filial],
	CASE WHEN PG.VALOR < 0 THEN PG.VALOR *-1 ELSE PG.VALOR END as [Valor]
FROM  
	PAGAMENTO PG, 
	CONTAARECEBER_R CONTA, 
	ACAOFINANCEIRA AF,
	ATOFINANCEIRO AT, 
	CATEGORIA CAT,
	TPO_R T,
	PESSOA_R filial
WHERE CONTA.RSITUACAO IN ( 2346, 2347 )
	AND CONTA.RTPO = T.OID
	AND FILIAL.OID = CONTA.REMITENTE
	AND CONTA.OID = AF.RCONTA 
	AND AF.OID = PG.RACAOFINANCEIRA
	AND AF.RATOFINANCEIRO = AT.OID 
	AND AT.RTIPO IN ( 2718, 23739, 23744 )  
	AND NOT ( AT.RTIPO = 23744 AND CONTA.RTIPO = 23669 )
	AND AT.RESTORNO = 7 
	AND PG.RTIPO = CAT.OID   
	AND CONTA.RMOEDA1 = 113702 
	AND CONTA.REMITENTE IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	AND CONTA.RTPO in (

		142402891, -- 13.01 - Aluguéis Recebidos
		9397590, -- 07.07 - Brindes para Indicadores
		2356845, --	13.02 - Cheque Devolvido Receita

	----SEM CONTA ESPECÍFICA ------------------------------------
	4945191 --Adiantamentos Colaboradores
	)

UNION ALL SELECT 
	'4', 
	FATOFINANCEIRO_R.OID as [Codigo],
	FATOFINANCEIRO_R.DATA as [Data],
	'-' as [Sinal],
	'09 - Despesas Administrativas' as [Tipo], 
	'Despesas Administrativas' as [Operacao],
	CASE 
		WHEN FATOFINANCEIRO_R.RTPO = 154201517	THEN '11.01 - ' + T.NOME --11.6
		WHEN FATOFINANCEIRO_R.RTPO = 252479014	THEN '11.02 - ' + T.NOME --11.6
		WHEN FATOFINANCEIRO_R.RTPO = 154260629	THEN '11.03 - ' + T.NOME --11.6
		WHEN FATOFINANCEIRO_R.RTPO = 259379944	THEN '11.04 - ' + T.NOME --11.6
		WHEN FATOFINANCEIRO_R.RTPO = 2318047	THEN '11.05 - ' + T.NOME	--11.6
		WHEN FATOFINANCEIRO_R.RTPO = 2318050	THEN '11.06 - ' + T.NOME	--11.6
		WHEN FATOFINANCEIRO_R.RTPO = 2318536	THEN '11.07 - ' + T.NOME --11.6
		WHEN FATOFINANCEIRO_R.RTPO = 4191965	THEN '11.08 - ' + T.NOME --11.6
		WHEN FATOFINANCEIRO_R.RTPO = 154260645	THEN '11.09 - ' + T.NOME	--11.6
		WHEN FATOFINANCEIRO_R.RTPO = 164202804	THEN '11.10 - ' + T.NOME	--11.6
	ELSE 'Nivel 4 Indeterminado - ' + T.NOME
	end as [Hierarquia],
	FILIAL.CODIGO as [Filial],
	FATOFINANCEIRO_R.VALOR/**FATOFINANCEIRO_R.SINAL*/ AS VALOR
FROM 
	FATOFINANCEIRO_R, UTILIZACAO U, TPO_R T, PESSOA_R FILIAL
WHERE FATOFINANCEIRO_R.OID = U.RITEM
	AND FILIAL.OID =  U.RUTILIZADO
	AND FATOFINANCEIRO_R.RTPO = T.OID
	AND FATOFINANCEIRO_R.SITUACAO = 1
	AND FATOFINANCEIRO_R.RATOFINANCEIRO <= 7
	AND FATOFINANCEIRO_R.RTPO > 7   
	AND FATOFINANCEIRO_R.RMOEDA = 113702 
	AND U.RUTILIZADO IN ( 2302256, 2302250, 2653583, 2653570, 1224953, 2537974, 227135206 ) 
	AND FATOFINANCEIRO_R.RTPO IN (
		154201517,	-- Comissão Amex
		252479014,	-- Comissão BIGCARD
		154260629,	-- Comissão Cabal
		259379944,	-- COMISSÃO GMINAS
		2318047,	-- Comissão Mastercard
		2318050,	-- Comissão Visa
		2318536,	-- Comissão CDC Banco do Brasil
		4191965,	-- Comissão Construcard
		154260645,	-- Comissão BNDS
		164202804	-- Comissão Cresol
	)

-- Listar 
------------------------------------------------------
select 
	--filial, 
	Tipo,Sinal, Hierarquia,  sum(valor) as Valor
from #tmp_DRE_Contrular
where 
	--filial = '01' and 
	data between '20180201' and '20180228 23:59:59' 
group by 	
	Tipo, Hierarquia, Sinal
	--filial
order by Hierarquia