-------------------------------------------------------------------------------------------------------------------------
-- TRANSAÇÃO CARTÃO
-- O VALOR DO AGRUPAMENTO NÃO PODE SER ZERO
-- O VALOR DO AGRUPAMENTO É CALCULADO PELO VALOR DA PARCELA * A TAXA DA ADMINISTRADORA
-------------------------------------------------------------------------------------------------------------------------

SELECT DISTINCT 	--'UPDATE AGRUPAMENTO SET VALOR =' + CONVERT(VARCHAR,STR((TC.VALPREV * ADT.NVALOR)/100,15,2)) + '  WHERE RPAPEL = 37501 AND OID = '+ CONVERT(VARCHAR,AGRU.OID),	--STR((TC.VALPREV * ADT.NVALOR)/100,15,2),	AGRU.oid,AGRU.VALOR, ADT.NVALOR, 	TC.ITEM,	TC.NUMPARC, 	TC.NSU_SITEF, 	TC.VALPREV, 	TC.OIDADMINISTRADORA, 	FIL.OID, 	TC.FILIAL, 	ADM.NOME,	FIL.NOME ,	TC.AUTORIZACAO, 	DOC.OID, 	TC.ATIVA,	TC.ENVIADO_CANCELAMENTO, 	TC.NSU_ADMINISTRADORAFROM TRANSACAOCARTAO TC      JOIN AGRUPAMENTO AGRU ON AGRU.RGRUPO = TC.ITEM AND RPAPEL = 37501      JOIN DOCDEORIGEM_R DOC ON DOC.OID = AGRU.RITEM      LEFT JOIN ADMINISTRADORA_R ADM ON ADM.OID = TC.OIDADMINISTRADORA	  LEFT JOIN ADITIVO_R ADT ON ADT.RITEM = TC.OIDADMINISTRADORA AND ADT.RDEFINICAO IN (16432, 19749)      LEFT JOIN FILIALCAD FIL ON FIL.FILIAL = TC.FILIAL WHERE 	--TC.DATA >=  '20160101'	TC.DATA >=  '20161019'  AND TC.DATA <  '20161020'  	AND DOC.OID NOT IN ( SELECT RDOCDEORIGEM FROM CONTAARECEBER_R WHERE RSITUACAO IN( 2346 , 2348 ) OR RTIPO = 36910)    AND TC.FILIAL IN( SELECT FILIAL FROM FILIALCAD WHERE OID = 2574288 ) 
	AND TC.OIDADMINISTRADORA = 101442659 
	--AND AGRU.VALOR = 0
ORDER BY TC.FILIAL, TC.OIDADMINISTRADORA, DOC.OID

select * from TRANSACAOCARTAO where item = 7209 --2016-12-08 00:00:00.000
--update TRANSACAOCARTAO set ENVIO_CONCILIACAO = null where item = 7209
--UPDATE AGRUPAMENTO SET VALOR = 25.40  WHERE RPAPEL = 37501 AND OID = 102116517
--UPDATE AGRUPAMENTO SET VALOR =  1.82  WHERE RPAPEL = 37501 AND OID = 103653098
--UPDATE AGRUPAMENTO SET VALOR =  3.08  WHERE RPAPEL = 37501 AND OID = 103673474
--UPDATE AGRUPAMENTO SET VALOR =  8.82  WHERE RPAPEL = 37501 AND OID = 95963967
--UPDATE AGRUPAMENTO SET VALOR =  1.88  WHERE RPAPEL = 37501 AND OID = 98495681
--UPDATE AGRUPAMENTO SET VALOR = 19.24  WHERE RPAPEL = 37501 AND OID = 101402200
--UPDATE AGRUPAMENTO SET VALOR =  1.76  WHERE RPAPEL = 37501 AND OID = 103653765
--UPDATE AGRUPAMENTO SET VALOR =  7.03  WHERE RPAPEL = 37501 AND OID = 103626834

select * from agrupamento where OID = 103626834
select * from docdeorigem_R where oid =103626831
select * from item where oid =2588859

SELECT DISTINCT FATO.RTPO, FATO.VALOR, FATO.OID, ATO.RTIPO, FATO.DATA   FROM FATOFINANCEIRO_R FATO   JOIN ATOFINANCEIRO ATO ON FATO.RATOFINANCEIRO = ATO.OID AND ATO.RTIPO IN ( 36908, 37789)   JOIN ACAOFINANCEIRA ACAO ON ACAO.RATOFINANCEIRO = ATO.OIDWHERE  FATO.RTIPO = 36920 AND ACAO.RCONTA IN(SELECT OID FROM CONTAARECEBER_R CR WHERE CR.RDOCDEORIGEM = 103626831 )
select * from acaofinanceira where rconta = 101151380select * from ATOFINANCEIRO where RTIPO IN( 36908, 37789) and oid = 101151384select * from FATOFINANCEIRO_R where ratofinanceiro =101151384